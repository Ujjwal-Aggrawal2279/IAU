<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Default Title{% endblock %}</title>
    <link rel="stylesheet" href="/assets/iau/css/customGlobal.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
    <style id="dynamic-styles">
        /* Default LTR (English) */
        .header nav.container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            direction: ltr;
        }

        #nav_items {
            direction: ltr;
            text-align: left;
        }

        /* RTL (Arabic) */
        .rtl .header nav.container {
            direction: rtl;
        }

        .rtl #nav_items {
            direction: rtl;
            text-align: right;
        }

        /* Default styles */
        ul li a {
            color: black;
            /* Default color */
        }

        .header {
            transition: all 0.3s ease;
        }

        .sticky {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            background-color: rgba(0, 0, 0, 0.537);
        }

        .language-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toggle-btn {
            font-size: 16px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.514);
        }

        .toggle-btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body style="width: 100%; height: 100vh;">
    <div class="header">
        <nav class="container">
            <div>
                <img src="/assets/iau/images/company_logo.png" alt="company_logo" style="width: 85%;" />
            </div>
            <div>
                <ul id="nav_items" style="display: flex; gap: 20px; list-style: none; align-items: center;">
                    <li><a href="/eservice/home"
                            style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase;">Home</a>
                    </li>
                    <li><a href="/eservice/home#about_us"
                            style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase;">About</a>
                    </li>
                    <li><a href="/eservice/home#latest_news"
                            style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase;">News</a>
                    </li>
                    <li><a href="/eservice/home#jobs_openings"
                            style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase;">Jobs</a>
                    </li>
                    <li><a href="/eservice/home#services"
                            style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase;">Services</a>
                    </li>
                    <li><a href="/eservice/home#projects"
                            style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase;">Projects</a>
                    </li>
                    <li><a href="/eservice/home#partnerships"
                            style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase;">Partnerships</a>
                    </li>
                    <li><a href="/eservice/home#partners"
                            style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase;">Partners</a>
                    </li>
                    <li id="nav-item-eservices" style="position: relative;"><a href="/login"
                            style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase;">E-services</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>

    {% block content %}
    <!-- Default content -->
    {% endblock %}

    <div class="footer" style="background-image: linear-gradient(180deg, #2B354E 0%, #101423 100%); height : 504px;">
        <div class="container" style="padding-top: 62px; padding-bottom : 62px;">
            <div class="divider">
                <span
                    style="text-transform: uppercase; font-size: 40px; font-weight : bold; font-family: 'Encode Sans Condensed'; color : white; margin : 0px 15px;">Contact
                    US</span>
            </div>
            <div style="margin-top : 40px; display: grid; grid-template-columns: repeat(3, 411px); gap: 30px;">
                <div
                    style="height : 101px; display: flex; align-items : center; padding : 11px;background: linear-gradient(180deg, #FFFFFF 0%, #EFE6D2 100%); gap: 35px">
                    <div
                        style="background: linear-gradient(180deg, #5C6B8F 0%, #1E2439 100%); width : 79px; height : 79px; display : flex; justify-content: center; align-items: center;">
                        <svg width="34" height="33" viewBox="0 0 34 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M2.28772 1.23118C3.6088 -0.0892547 7.6026 -0.309897 7.63261 0.389079C7.66261 1.08694 11.2293 8.83192 11.2601 9.53107C11.2911 10.2298 8.90916 12.61 8.21249 13.3067C7.52185 13.9963 12.8729 20.0409 12.9742 20.1551C13.088 20.2573 19.1357 25.6048 19.8263 24.9141C20.5232 24.2175 22.906 21.8373 23.6027 21.8683C24.3014 21.8982 32.0521 25.4626 32.751 25.4946C33.4497 25.5245 33.2296 29.5146 31.9084 30.836C30.7784 31.9647 24.9282 36.0629 14.7555 28.7445C13.64 28.1033 11.8733 26.6324 9.19378 23.9556C9.19286 23.9547 9.19078 23.9526 9.1887 23.9514C9.18663 23.9485 9.18455 23.9473 9.18247 23.9452C9.18039 23.9432 9.17832 23.9411 9.17624 23.939C9.17532 23.9369 9.17324 23.9349 9.17209 23.934C6.49459 21.256 5.02233 19.4892 4.38037 18.375C-2.94193 8.2075 1.15897 2.35983 2.28782 1.23129L2.28772 1.23118Z"
                                fill="white" />
                        </svg>
                    </div>
                    <p
                        style="font-family: 'Encode Sans Condensed'; font-size : 28px; color : #101423; font-weight : 700; line-height : 35px">
                        013 333 5024</p>
                </div>
                <div
                    style="height : 101px; display: flex; align-items : center; padding : 11px;background: linear-gradient(180deg, #FFFFFF 0%, #EFE6D2 100%); gap: 35px">
                    <div
                        style="background: linear-gradient(180deg, #5C6B8F 0%, #1E2439 100%); width : 79px; height : 79px; display : flex; justify-content: center; align-items: center;">
                        <svg width="38" height="21" viewBox="0 0 38 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M1.34082 0L18.8998 13.6111L36.4588 0H1.34082ZM0.390625 1.41736V19.845L11.4909 10.0274L0.390625 1.41736ZM37.4099 1.41736L26.3096 10.0274L37.4099 19.845V1.41736ZM12.8681 11.0909L1.6852 21H36.1153L24.9324 11.0909L19.4513 15.3434H19.4516C19.1294 15.5892 18.672 15.5892 18.3498 15.3434L12.8687 11.0909H12.8681Z"
                                fill="white" />
                        </svg>
                    </div>
                    <p
                        style="font-family: 'Encode Sans Condensed'; font-size : 28px; color : #101423; font-weight : 700; line-height : 35px">
                        ics@iau.edu.sa</p>
                </div>
                <div
                    style="height : 101px; display: flex; align-items : center; padding : 11px;background: linear-gradient(180deg, #FFFFFF 0%, #EFE6D2 100%); gap: 35px">
                    <div
                        style="background: linear-gradient(180deg, #5C6B8F 0%, #1E2439 100%); width : 79px; height : 79px; display : flex; justify-content: center; align-items: center;">
                        <svg width="33" height="32" viewBox="0 0 33 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_288_537)">
                                <path
                                    d="M19.72 13.5513L31.6409 0H28.817L18.4617 11.764L10.1972 0H0.662598L13.163 17.791L0.662598 31.9999H3.48647L14.4148 19.574L23.1447 31.9999H32.6793M4.50566 2.08252H8.84392L28.8149 30.0197H24.4755"
                                    fill="white" />
                            </g>
                            <defs>
                                <clipPath id="clip0_288_537">
                                    <rect width="32.0167" height="32" fill="white" transform="translate(0.662598)" />
                                </clipPath>
                            </defs>
                        </svg>
                    </div>
                    <p
                        style="font-family: 'Encode Sans Condensed'; font-size : 28px; color : #101423; font-weight : 700; line-height : 35px">
                        @iau_icss</p>
                </div>
            </div>
            <div style="margin-top : 120px; display: grid; grid-template-columns: repeat(3, 411px); gap: 30px">
                <div>
                    <a href="/eservice/home" style="text-decoration: none;">
                        <p
                            style="text-decoration: underline; font-size : 22px; font-weight: 700; color : white; font-family : Inter Display;">
                            Homepage</p>
                    </a>
                </div>
                <div>
                    <p
                        style="font-size : 20px; text-align : center; font-family : Inter Display; font-weight : 400; color : white">
                        © 2024 Imam Abdulrahman Bin Faisal University.
                    </p>
                    <p
                        style="font-size : 20px; text-align : center; font-family : Inter Display; font-weight : 400; color : white">
                        All rights reserved.
                    </p>
                </div>
                <div>
                    <p
                        style="font-size : 22px; font-weight: 400; color : white; font-family : Inter Display; text-align : right;">
                        Implemented by Makwiz Technologies</p>
                </div>
            </div>
        </div>
    </div>
    <div id="language-toggle" class="language-toggle">
        <button id="toggle-btn" class="toggle-btn">عربي</button>
        <!-- Hidden select element to simulate language change -->
        <select id="language-selector" style="display:none;">
            <option value="en">English</option>
            <option value="ar">عربي</option>
        </select>
    </div>
    <script>
        // Add sticky Header
        window.onscroll = function () { stickyHeader() };

        const header = document.querySelector('.header');

        function stickyHeader() {
            if (window.scrollY > 150) {
                header.classList.add('sticky');
            } else if (window.scrollY < 150) {
                header.classList.remove('sticky');
            }
        }
        // Async function to check if the User is logged in and get their avatar
        async function getUserAvatar() {
            try {
                // Getting the logged-in user's ID
                const response = await fetch('/api/method/frappe.auth.get_logged_user', {
                    method: 'GET',
                });

                if (!response.ok) {
                    throw new Error('User is not logged in or session has expired.');
                }

                const { message: userId } = await response.json(); // Extract the user ID

                // Getting the user's details using their ID
                const userDetailsResponse = await fetch(`/api/resource/User/${userId}`, {
                    method: 'GET',
                });

                if (!userDetailsResponse.ok) {
                    throw new Error('Failed to fetch user details.');
                }

                const { data: userDetails } = await userDetailsResponse.json(); // Extract user details

                // Access the user's avatar and name
                const userImage = userDetails.user_image;
                const userName = userDetails.full_name;

                // Replace the "E-services" link with the user's avatar and dropdown menu
                const navItemEservices = document.getElementById('nav-item-eservices');
                navItemEservices.innerHTML = `
                    <a href="#" id="user-menu-toggle" style="text-decoration: none; font-family: 'Encode Sans Condensed'; font-size: 20px; text-transform: uppercase; display: flex; align-items: center;">
                        <img src="${userImage}" alt="User Avatar" id="user-avatar" style="width: 40px; height: 40px; border-radius: 50%; border: 1px solid #101423; margin-right: 10px;">
                    </a>
                    <div id="dropdown-menu" style="display: none; position: absolute; top: 100%; right: 0; background-color: #fff; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; width: 200px; background-color: #EFE6D2;">
                        <a href="/eservice/profile" style="display: block; padding: 12px 16px; text-decoration: none; color: #000; font-family: 'Encode Sans Condensed'; font-size: 16px; font-weight : bold;">Profile</a>
                        <a href="#" id="logout-link" style="display: block; padding: 12px 16px; text-decoration: none; color: #000; font-family: 'Encode Sans Condensed'; font-size: 16px; font-weight : bold;">Logout</a>
                    </div>
                `;

                // Add event listener for the dropdown toggle
                document.getElementById('user-menu-toggle').addEventListener('click', (event) => {
                    event.preventDefault();
                    const dropdownMenu = document.getElementById('dropdown-menu');
                    dropdownMenu.style.display = (dropdownMenu.style.display === 'none' || dropdownMenu.style.display === '') ? 'block' : 'none';
                });

                // Logout Link
                document.getElementById('logout-link').addEventListener('click', async (event) => {
                    event.preventDefault();
                    try {
                        const logoutResponse = await fetch('/api/method/logout');
                        if (logoutResponse.ok) {
                            window.location.href = '/eservice/home';
                        } else {
                            throw new Error('Logout failed.');
                        }
                    } catch (error) {
                        console.error('Error:', error.message);
                    }
                });

                // Close dropdown when clicking outside of it
                document.addEventListener('click', (event) => {
                    const dropdownMenu = document.getElementById('dropdown-menu');
                    if (!event.target.closest('#nav-item-eservices')) {
                        dropdownMenu.style.display = 'none';
                    }
                });

            } catch (error) {
                console.error('Error:', error.message);
            }
        }

        // Call the function to get the user's avatar
        getUserAvatar();

        function updateStylesBasedOnTitle() {
            var pageTitle = document.title;
            var styleSheet = document.getElementById('dynamic-styles').sheet;
            var logoImg = document.querySelector('nav img');

            if (pageTitle !== 'Home') {
                // Apply styles for non-Home pages
                styleSheet.insertRule('ul li a { color: black; }', styleSheet.cssRules.length);
                logoImg.src = '/assets/iau/images/Auth Logo.png';
            } else {
                // Apply default styles
                styleSheet.insertRule('ul li a { color: black; }', styleSheet.cssRules.length);
                logoImg.src = '/assets/iau/images/company_logo.png';
            }
        }

        // Call the function to apply styles and update the logo
        updateStylesBasedOnTitle();

        // Initialize the currentLanguage from localStorage or default to 'en'
        let currentLanguage = localStorage.getItem('language') || 'en';

        // Set the initial language on page load
        document.addEventListener('DOMContentLoaded', () => {
            const button = document.getElementById('toggle-btn');
            const languageSelector = document.getElementById('language-selector');
            const body = document.body;

            if (currentLanguage === 'ar') {
                button.textContent = 'English';
                languageSelector.value = 'ar'; // Simulate select change
                body.classList.add('rtl');
            } else {
                button.textContent = 'عربي';
                languageSelector.value = 'en'; // Simulate select change
                body.classList.remove('rtl');
            }

            // Fetch translations on page load if language is not English
            if (currentLanguage !== 'en') {
                fetchTranslations(currentLanguage);
            }
        });

        // Event listener for the toggle button
        document.getElementById('toggle-btn').addEventListener('click', () => {
            const button = document.getElementById('toggle-btn');
            const languageSelector = document.getElementById('language-selector');
            const body = document.body;

            // Toggle between English and Arabic
            if (currentLanguage === 'en') {
                currentLanguage = 'ar';
                button.textContent = 'English';
                languageSelector.value = 'ar'; // Simulate select change
                body.classList.add('rtl');
            } else {
                currentLanguage = 'en';
                button.textContent = 'عربي';
                languageSelector.value = 'en'; // Simulate select change
                body.classList.remove('rtl');
            }

            // Save the selected language to localStorage
            localStorage.setItem('language', currentLanguage);

            // Fetch translations if not English
            if (currentLanguage !== 'en') {
                fetchTranslations(currentLanguage);
            } else {
                resetToEnglish();
            }
        });

        // Event listener for the language selector
        document.getElementById('language-selector').addEventListener('change', (event) => {
            const selectedLanguage = event.target.value;

            if (selectedLanguage === 'en') {
                currentLanguage = 'en';
                localStorage.setItem('language', 'en');
                resetToEnglish();
            } else {
                currentLanguage = 'ar';
                localStorage.setItem('language', 'ar');
                fetchTranslations(selectedLanguage);
            }
        });

        // Fetch translations from the server
        async function fetchTranslations(language) {
            try {
                const response = await fetch(`/api/resource/Translation?filters=[["language", "=", "${language}"]]&fields=["source_text", "translated_text"]`);
                const { data } = await response.json();

                // Reset sourceTexts and translations before updating
                sourceTexts = [];
                translations = {};

                data.forEach(item => {
                    // Split source_text by newline and add each to sourceTexts array
                    const sources = item.source_text.split('\n');
                    const translationsList = item.translated_text.split('\n');

                    // Update sourceTexts dynamically
                    sources.forEach((text, index) => {
                        const trimmedText = text.trim();
                        sourceTexts.push(trimmedText); // Add source text to sourceTexts array
                        translations[trimmedText] = translationsList[index].trim(); // Map source to translation
                    });
                });

                // Replace text in the navigation with the new translations
                replaceTextInDocument();

            } catch (error) {
                console.error('Error fetching translations:', error);
            }
        }

        function replaceTextInDocument() {
            const navItems = document.querySelector('#nav_items');

            // Loop through all source texts and replace them
            sourceTexts.forEach(sourceText => {
                const translatedText = translations[sourceText] || sourceText;

                // Replace text in all <a> tags within #nav_items
                navItems.querySelectorAll('a').forEach(anchor => {
                    if (anchor.textContent.includes(sourceText)) {
                        anchor.textContent = anchor.textContent.replace(new RegExp(sourceText, 'g'), translatedText);
                    }
                });
            });
        }

        function resetToEnglish() {
            const navItems = document.querySelector('#nav_items');

            navItems.querySelectorAll('a').forEach(anchor => {
                const originalText = Object.keys(translations).find(sourceText => {
                    const translatedText = translations[sourceText];
                    return anchor.textContent.trim() === translatedText;
                });

                if (originalText) {
                    anchor.textContent = originalText;
                }
            });
        }
    </script>
</body>

</html>